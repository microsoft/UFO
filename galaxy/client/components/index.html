<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Components - UFO³ Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Components";
        var mkdocs_page_input_path = "galaxy/client/components.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> UFO³ Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../choose_path/">Choose Your Path</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../project_directory_structure/">Project Directory Structure</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/quick_start_galaxy/">Quick Start (UFO³ Agent Galaxy)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/quick_start_ufo2/">Quick Start (UFO²)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/quick_start_linux/">Quick Start (Linux Agent)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/quick_start_mobile/">Quick Start (Mobile Agent)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/migration_ufo2_to_galaxy/">Migration UFO² → UFO³</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting_started/more_guidance/">More Guidance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Configuration & Setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Configuration System</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/agents_config/">Agent Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/system_config/">System Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/rag_config/">RAG Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/prices_config/">Pricing Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/third_party_config/">Third-Party Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/mcp_reference/">MCP Reference</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/migration/">Migration Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/system/extending/">Extending Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Galaxy Configuration</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../configuration/system/galaxy_devices/">Devices</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../configuration/system/galaxy_constellation/">Constellation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../configuration/system/galaxy_agent/">Agent</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Model Setup</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/openai/">OpenAI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/azure_openai/">Azure OpenAI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/operator/">OpenAI CUA (Operator)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/gemini/">Gemini</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/claude/">Claude</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/qwen/">Qwen</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/deepseek/">DeepSeek</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/ollama/">Ollama</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../configuration/models/custom_model/">Custom Model</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">UFO³ Agent Galaxy</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../webui/">WebUI</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Galaxy Client</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../constellation_client/">ConstellationClient</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../device_manager/">DeviceManager</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Components</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#component-architecture-overview">Component Architecture Overview</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#the-big-picture-how-components-collaborate">The Big Picture: How Components Collaborate</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#device-management-components">Device Management Components</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#deviceregistry-the-single-source-of-truth">DeviceRegistry: The Single Source of Truth</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#websocketconnectionmanager-network-communication-handler">WebSocketConnectionManager: Network Communication Handler</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#heartbeatmanager-connection-health-monitor">HeartbeatManager: Connection Health Monitor</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#messageprocessor-message-router-and-handler">MessageProcessor: Message Router and Handler</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#taskqueuemanager-task-scheduling-and-queuing">TaskQueueManager: Task Scheduling and Queuing</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#display-component">Display Component</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#clientdisplay-user-interface-and-console-output">ClientDisplay: User Interface and Console Output</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#support-components">Support Components</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#statusmanager-system-wide-status-aggregation">StatusManager: System-Wide Status Aggregation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-components-work-together-a-complete-example">How Components Work Together: A Complete Example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#component-dependencies">Component Dependencies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-components">Testing Components</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#related-documentation_1">Related Documentation</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../aip_integration/">AIP Integration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../galaxy_client/">GalaxyClient</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Agent Registration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../agent_registration/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agent_registration/agent_profile/">Agent Profile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agent_registration/device_registry/">Device Registry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agent_registration/registration_flow/">Registration Flow</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Task Constellation (DAG)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation/task_star/">TaskStar</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation/task_star_line/">TaskStarLine</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation/task_constellation/">TaskConstellation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation/constellation_editor/">ConstellationEditor</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Constellation Agent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_agent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_agent/state/">State Machine</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_agent/strategy/">Strategy Pattern</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_agent/command/">MCP Commands</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Constellation Orchestrator</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/event_driven_coordination/">Event-Driven Coordination</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/asynchronous_scheduling/">Asynchronous Scheduling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/safe_assignment_locking/">Safe Assignment Locking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/consistency_guarantees/">Consistency Guarantees</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/batched_editing/">Batched Editing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/constellation_manager/">Constellation Manager</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../constellation_orchestrator/api_reference/">API Reference</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Observer System</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/event_system/">Event System</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/progress_observer/">Progress Observer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/agent_output_observer/">Agent Output Observer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/synchronizer/">Synchronizer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/metrics_observer/">Metrics Observer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observer/visualization_observer/">Visualization Observer</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Evaluation & Logging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../evaluation/trajectory_report/">Trajectory Report</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../evaluation/performance_metrics/">Performance Metrics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../evaluation/result_json/">Result JSON Reference</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">UFO² Desktop AgentOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ufo2/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ufo2/as_galaxy_device/">Using as Galaxy Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >HostAgent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/host_agent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/host_agent/state/">State Machine</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/host_agent/strategy/">Processing Strategy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/host_agent/commands/">Command System</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >AppAgent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/app_agent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/app_agent/state/">State Machine</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/app_agent/strategy/">Processing Strategy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/app_agent/commands/">Command System</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Core Features</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/core_features/hybrid_actions/">Hybrid GUI–API Actions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Control Detection</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/control_detection/overview/">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/control_detection/uia_detection/">UIA Detection</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/control_detection/visual_detection/">Visual Detection</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/control_detection/hybrid_detection/">Hybrid Detection</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Knowledge Substrate</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/knowledge_substrate/overview/">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/knowledge_substrate/learning_from_help_document/">Help Documents</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/knowledge_substrate/learning_from_bing_search/">Bing Search</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/knowledge_substrate/experience_learning/">Experience Learning</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/core_features/knowledge_substrate/learning_from_demonstration/">Demos</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/core_features/multi_action/">Speculative Multi-Action</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Advanced Usage</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/advanced_usage/follower_mode/">Follower Mode</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/advanced_usage/batch_mode/">Batch Mode</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/advanced_usage/operator_as_app_agent/">Operator Integration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/advanced_usage/customization/">Customization</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Prompts</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/prompts/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/prompts/basic_template/">Basic Template</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/prompts/examples_prompts/">Examples</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Evaluation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/evaluation/evaluation_agent/">EvaluationAgent</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/evaluation/benchmark/overview/">Benchmark Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/evaluation/benchmark/windows_agent_arena/">Windows Agent Arena</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/evaluation/benchmark/osworld/">OSWorld (Windows)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Performance Logs</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/overview/">Overview</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/evaluation_logs/">Evaluation Logs</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/markdown_log_viewer/">Markdown Log Viewer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/request_logs/">Request Logs</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/screenshots_logs/">Screenshots Logs</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/step_logs/">Step Logs</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../ufo2/evaluation/logs/ui_tree_logs/">UI Tree Logs</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Dataflow</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/dataflow/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/dataflow/instantiation/">Instantiation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/dataflow/execution/">Execution</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/dataflow/windows_app_env/">Windows App Environment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ufo2/dataflow/result/">Result</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Linux Agent</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../linux/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../linux/as_galaxy_device/">Using as Galaxy Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../linux/state/">State Machine</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../linux/strategy/">Processing Strategy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../linux/commands/">MCP Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Mobile Agent</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mobile/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mobile/as_galaxy_device/">Using as Galaxy Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mobile/state/">State Machine</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mobile/strategy/">Processing Strategy</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mobile/commands/">MCP Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials & Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/creating_mcp_servers/">Creating Custom MCP Servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/creating_third_party_agents/">Creating Custom Third-Party Agents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Creating Custom Device Agents</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/">Index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/client_setup/">Client Setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/core_components/">Core Components</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/mcp_server/">MCP Server</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/configuration/">Configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/testing/">Testing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_device_agent/example_mobile_agent/">Example Mobile Agent</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Enhancing AppAgent Capabilities</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_app_agent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_app_agent/help_document_provision/">Help Document Provision</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_app_agent/demonstration_provision/">Demonstration Provision</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../tutorials/creating_app_agent/warpping_app_native_api/">Wrapping App-Native APIs</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Infrastructure</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Basic Modules</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/session/">Session</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/round/">Round</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/context/">Context</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/dispatcher/">Dispatcher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/session_pool/">Session Factory & Pool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/modules/platform_sessions/">Platform Sessions</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Device Agent Architecture</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/agents/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/agents/agent_types/">Agent Types & Implementation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../infrastructure/agents/server_client_architecture/">Server-Client Architecture</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Architecture Layers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/state/">State Layer (Level-1)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/processor/">Strategy Layer (Level-2)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/strategy/">Strategy Components</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/command/">Command Layer (Level-3)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Supporting Systems</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/memory/">Memory System</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/blackboard/">Blackboard</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../infrastructure/agents/design/prompter/">Prompter</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Agent Interaction Protocol (AIP)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/messages/">Message Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/protocols/">Protocol Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/transport/">Transport Layer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/endpoints/">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../aip/resilience/">Resilience</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Agent Server</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/quick_start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/session_manager/">Session Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/websocket_handler/">WebSocket Handler</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/client_connection_manager/">Client Connection Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/api/">HTTP API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../server/monitoring/">Monitoring</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Agent Client</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/quick_start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/websocket_client/">WebSocket Client</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/ufo_client/">UFO Client</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/computer_manager/">Computer Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/computer/">Computer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/device_info/">Device Info Provider</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../client/mcp_integration/">MCP Integration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">MCP (Model Context Protocol)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/data_collection/">Data Collection Servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/action/">Action Servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/configuration/">Configuration Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/local_servers/">Local Servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../mcp/remote_servers/">Remote Servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Server Reference</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/ui_collector/">UICollector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/host_ui_executor/">HostUIExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/app_ui_executor/">AppUIExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/command_line_executor/">CommandLineExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/word_com_executor/">WordCOMExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/excel_com_executor/">ExcelCOMExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/ppt_com_executor/">PowerPointCOMExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/pdf_reader_executor/">PDFReaderExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/constellation_editor/">ConstellationEditor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/hardware_executor/">HardwareExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/bash_executor/">BashExecutor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../mcp/servers/mobile_executor/">MobileExecutor</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/CONTRIBUTING/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/LICENSE/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/CODE_OF_CONDUCT/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/DISCLAIMER/">Disclaimer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../about/SUPPORT/">Support</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../faq/">FAQ</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">UFO³ Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">UFO³ Agent Galaxy</li>
          <li class="breadcrumb-item">Galaxy Client</li>
      <li class="breadcrumb-item active">Components</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="galaxy-client-components">Galaxy Client Components</h1>
<p>Galaxy Client is built from focused, single-responsibility components that work together to provide device management capabilities. This document explains how these components interact and what each one does.</p>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../overview/">Overview</a> - Overall Galaxy Client architecture</li>
<li><a href="../device_manager/">DeviceManager</a> - How DeviceManager orchestrates these components</li>
<li><a href="../constellation_client/">ConstellationClient</a> - How components are used in the coordination layer</li>
<li><a href="../aip_integration/">AIP Integration</a> - Message protocol used by components</li>
</ul>
<hr />
<h2 id="component-architecture-overview">Component Architecture Overview</h2>
<p>Galaxy Client uses 8 modular components divided into three categories: <strong>Device Management</strong>, <strong>Display &amp; UI</strong>, and <strong>Support Components</strong>. Understanding how these components work together is key to understanding Galaxy Client's design.</p>
<h3 id="the-big-picture-how-components-collaborate">The Big Picture: How Components Collaborate</h3>
<p>When DeviceManager needs to manage a device connection, it doesn't do everything itself. Instead, it delegates specific responsibilities to specialized components:</p>
<div class="mermaid">graph TB
    DM[DeviceManager&lt;br/&gt;Orchestrator]

    subgraph "State Management"
        DR[DeviceRegistry&lt;br/&gt;Device State Storage]
    end

    subgraph "Connection Layer"
        WS[WebSocketConnectionManager&lt;br/&gt;Network Communication]
        HM[HeartbeatManager&lt;br/&gt;Health Monitoring]
        MP[MessageProcessor&lt;br/&gt;Message Handling]
    end

    subgraph "Task Layer"
        TQ[TaskQueueManager&lt;br/&gt;Task Scheduling]
    end

    DM --&gt; DR
    DM --&gt; WS
    DM --&gt; HM
    DM --&gt; MP
    DM --&gt; TQ

    WS -.-&gt;|updates| DR
    HM -.-&gt;|reads| DR
    HM -.-&gt;|uses| WS
    MP -.-&gt;|updates| DR
    MP -.-&gt;|uses| WS

    style DM fill:#e1f5ff
    style DR fill:#fff4e1</div>
<p>This diagram shows the component relationships. DeviceManager acts as the orchestrator, creating and coordinating all other components. DeviceRegistry serves as the single source of truth for device state. WebSocketConnectionManager, HeartbeatManager, and MessageProcessor all depend on both DeviceRegistry (for state) and each other (for operations). TaskQueueManager works independently, managing task queues.</p>
<p><strong>Key Design Principles:</strong></p>
<ol>
<li>
<p><strong>Single Source of Truth</strong>: DeviceRegistry is the only component that stores device state. All other components read from or write to DeviceRegistry, never maintaining their own state.</p>
</li>
<li>
<p><strong>Dependency Injection</strong>: DeviceManager creates all components and injects dependencies. For example, HeartbeatManager receives references to both WebSocketConnectionManager (to send heartbeats) and DeviceRegistry (to update timestamps).</p>
</li>
<li>
<p><strong>Background Services</strong>: HeartbeatManager and MessageProcessor run as independent asyncio tasks. They operate continuously in the background without blocking the main execution flow.</p>
</li>
<li>
<p><strong>Component Independence</strong>: Each component can be tested and understood in isolation. Changing one component's implementation doesn't affect others as long as the interface remains the same.</p>
</li>
</ol>
<hr />
<h2 id="device-management-components">Device Management Components</h2>
<p>These components handle the core device lifecycle: registration, connection, monitoring, and task execution.</p>
<h3 id="deviceregistry-the-single-source-of-truth">DeviceRegistry: The Single Source of Truth</h3>
<p><strong>Purpose</strong>: DeviceRegistry is the central repository for all device information. Every component that needs to know about device state queries DeviceRegistry.</p>
<p><strong>What It Stores</strong>: Each device is represented by an <code>AgentProfile</code> object containing:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AgentProfile</span><span class="p">:</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>              <span class="c1"># Unique device identifier</span>
    <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>             <span class="c1"># WebSocket endpoint</span>
    <span class="n">os</span><span class="p">:</span> <span class="nb">str</span>                     <span class="c1"># Operating system (windows/linux/mac)</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DeviceStatus</span>        <span class="c1"># Current state (DISCONNECTED/CONNECTING/CONNECTED/IDLE/BUSY/FAILED)</span>
    <span class="n">capabilities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>     <span class="c1"># What the device can do ([&quot;office&quot;, &quot;web&quot;, &quot;email&quot;])</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>    <span class="c1"># Custom device properties</span>
    <span class="n">last_heartbeat</span><span class="p">:</span> <span class="n">datetime</span>    <span class="c1"># Last successful heartbeat timestamp</span>
    <span class="n">connection_attempts</span><span class="p">:</span> <span class="nb">int</span>    <span class="c1"># Number of connection attempts made</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span>           <span class="c1"># Maximum reconnection attempts allowed</span>
    <span class="n">current_task_id</span><span class="p">:</span> <span class="nb">str</span>       <span class="c1"># Task being executed (None if idle)</span>
    <span class="n">system_info</span><span class="p">:</span> <span class="n">Dict</span>          <span class="c1"># Hardware/software details from device</span>
</code></pre></div>
<p>The <code>status</code> field is particularly important as it drives the system's behavior. When a device is IDLE, it can accept new tasks. When BUSY, tasks are queued. When DISCONNECTED, reconnection is attempted.</p>
<p><strong>Key Operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Registration and lookup</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">server_url</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">capabilities</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
<span class="n">all_devices</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_all_devices</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Status management</span>
<span class="n">registry</span><span class="o">.</span><span class="n">update_device_status</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">DeviceStatus</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">)</span>
<span class="n">is_busy</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">is_device_busy</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">set_device_busy</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_id</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">set_device_idle</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>

<span class="c1"># Health tracking</span>
<span class="n">registry</span><span class="o">.</span><span class="n">update_heartbeat</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">increment_connection_attempts</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">reset_connection_attempts</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
</code></pre></div>
<p><strong>Why It Matters</strong>: Having a single registry prevents state inconsistencies. Without DeviceRegistry, each component might have its own view of device state, leading to race conditions and bugs. For example, HeartbeatManager might think a device is connected while MessageProcessor thinks it's disconnected.</p>
<h3 id="websocketconnectionmanager-network-communication-handler">WebSocketConnectionManager: Network Communication Handler</h3>
<p><strong>Purpose</strong>: Manages the low-level WebSocket connections to Agent Server and handles message transmission.</p>
<p><strong>Connection Lifecycle</strong>:</p>
<p>When <code>connect_to_device()</code> is called, WebSocketConnectionManager performs these steps:</p>
<ol>
<li>
<p><strong>Establish WebSocket</strong>: Creates an AIP <code>WebSocketTransport</code> and connects to the device's server_url. This is an async operation that may timeout or fail due to network issues.</p>
</li>
<li>
<p><strong>Start Message Handler BEFORE Registration</strong>: Crucially, this happens <em>before</em> sending REGISTER to prevent race conditions. The message handler is started via MessageProcessor to ensure we don't miss the server's response.</p>
</li>
<li>
<p><strong>Send REGISTER</strong>: Uses <code>RegistrationProtocol</code> to send an AIP REGISTER message identifying this client to the server. The server responds with a HEARTBEAT message with OK status to confirm registration.</p>
</li>
<li>
<p><strong>Store Transport</strong>: Saves the WebSocketTransport object and initializes AIP protocol handlers (<code>RegistrationProtocol</code>, <code>TaskExecutionProtocol</code>, <code>DeviceInfoProtocol</code>) for this connection.</p>
</li>
</ol>
<p><strong>Task Execution</strong>:</p>
<p>When sending a task to a device, WebSocketConnectionManager:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_task_to_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_request</span><span class="p">):</span>
    <span class="c1"># 1. Get Transport and TaskExecutionProtocol</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span>
    <span class="n">task_protocol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_protocols</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span>

    <span class="c1"># 2. Create AIP ClientMessage for task execution</span>
    <span class="n">task_message</span> <span class="o">=</span> <span class="n">ClientMessage</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">ClientMessageType</span><span class="o">.</span><span class="n">TASK</span><span class="p">,</span>
        <span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">CONSTELLATION</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="n">task_client_id</span><span class="p">,</span>
        <span class="n">target_id</span><span class="o">=</span><span class="n">device_id</span><span class="p">,</span>
        <span class="n">task_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;galaxy/</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">task_request</span><span class="o">.</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">request</span><span class="o">=</span><span class="n">task_request</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
        <span class="n">session_id</span><span class="o">=</span><span class="n">constellation_task_id</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">CONTINUE</span><span class="p">,</span>
        <span class="o">...</span>
    <span class="p">)</span>

    <span class="c1"># 3. Send message via AIP transport</span>
    <span class="k">await</span> <span class="n">transport</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">task_message</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

    <span class="c1"># 4. Wait for response (handled via future)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_response</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">constellation_task_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ExecutionResult</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p>The <code>_wait_for_task_completion()</code> method creates an asyncio.Future that MessageProcessor will complete when it receives the TASK_END message from the device.</p>
<p><strong>Error Handling</strong>: WebSocketConnectionManager catches connection errors (InvalidURI, WebSocketException, OSError, TimeoutError) and returns False, allowing DeviceManager to trigger reconnection logic.</p>
<h3 id="heartbeatmanager-connection-health-monitor">HeartbeatManager: Connection Health Monitor</h3>
<p><strong>Purpose</strong>: Continuously monitors device health by sending periodic heartbeat messages. This detects connection failures faster than waiting for a task to timeout.</p>
<p><strong>How It Works</strong>:</p>
<p>For each connected device, HeartbeatManager starts an independent background task that uses AIP <code>HeartbeatProtocol</code> to send HEARTBEAT messages periodically and verify the device is still responsive.</p>
<p><strong>Timeout Detection</strong>: Uses a timeout mechanism to detect when devices stop responding. If no heartbeat response arrives within the expected timeframe, the device is considered disconnected and HeartbeatManager triggers the disconnection handler.</p>
<p><strong>Why Not Just Use TCP Keepalive?</strong>: WebSocket runs over TCP, which has its own keepalive mechanism. However, TCP keepalive operates at a much longer timescale (typically 2 hours by default) and only detects network-level failures, not application-level hangs. HeartbeatManager detects if the device agent is responsive, not just if the TCP connection is alive.</p>
<h3 id="messageprocessor-message-router-and-handler">MessageProcessor: Message Router and Handler</h3>
<p><strong>Purpose</strong>: Runs a continuous message receiving loop for each device, dispatching incoming AIP messages to appropriate handlers.</p>
<p><strong>The Message Loop</strong>:</p>
<p>MessageProcessor runs a background task that receives messages from the AIP transport and routes them based on message type. It handles <code>TASK_END</code> messages by completing the corresponding future that WebSocketConnectionManager is waiting on, enabling async task execution patterns.</p>
<p><strong>Task Completion Handling</strong>: When a TASK_END message arrives, MessageProcessor uses the <code>complete_task_response()</code> method in WebSocketConnectionManager to resolve the pending future for that task.</p>
<p><strong>Why Run in Background</strong>: The message loop runs continuously as an asyncio task. This allows it to receive messages asynchronously while the main execution flow (e.g., sending tasks) continues unblocked. Without this, we'd need to alternate between sending and receiving, making the code much more complex.</p>
<h3 id="taskqueuemanager-task-scheduling-and-queuing">TaskQueueManager: Task Scheduling and Queuing</h3>
<p><strong>Purpose</strong>: Manages per-device task queues, ensuring tasks execute sequentially when devices are busy.</p>
<p><strong>Queue Behavior</strong>:</p>
<p>When a task is assigned to a device that's already executing another task:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># In DeviceManager.assign_task_to_device()</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">is_device_busy</span><span class="p">(</span><span class="n">device_id</span><span class="p">):</span>
    <span class="c1"># Device is BUSY - enqueue task</span>
    <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_queue_manager</span><span class="o">.</span><span class="n">enqueue_task</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_request</span><span class="p">)</span>
    <span class="c1"># Wait for task to complete</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">future</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Device is IDLE - execute immediately</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_task_on_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_request</span><span class="p">)</span>
</code></pre></div>
<p><strong>How Queuing Works</strong>:</p>
<p>TaskQueueManager maintains a dictionary of queues: <code>{device_id: queue}</code>. Each queue is a list of <code>(task_request, future)</code> tuples. When a task is enqueued:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enqueue_task</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_request</span><span class="p">):</span>
    <span class="c1"># Create a future for this task</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>

    <span class="c1"># Add to device&#39;s queue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queues</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">task_request</span><span class="p">,</span> <span class="n">future</span><span class="p">))</span>

    <span class="c1"># Return future so caller can await result</span>
    <span class="k">return</span> <span class="n">future</span>
</code></pre></div>
<p>When a device completes a task and becomes IDLE, DeviceManager calls:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_process_next_queued_task</span><span class="p">(</span><span class="n">device_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_queue_manager</span><span class="o">.</span><span class="n">has_queued_tasks</span><span class="p">(</span><span class="n">device_id</span><span class="p">):</span>
        <span class="n">task_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_queue_manager</span><span class="o">.</span><span class="n">dequeue_task</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
        <span class="c1"># Execute next task (don&#39;t await to avoid blocking)</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execute_task_on_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">task_request</span><span class="p">))</span>
</code></pre></div>
<p><strong>Why Futures?</strong>: Using asyncio.Future allows the calling code to await task completion even though the task is queued. The caller doesn't need to know whether the task executed immediately or was queued—it just awaits the future and gets the result when ready.</p>
<hr />
<h2 id="display-component">Display Component</h2>
<h3 id="clientdisplay-user-interface-and-console-output">ClientDisplay: User Interface and Console Output</h3>
<p><strong>Purpose</strong>: Provides Rich-based console output for interactive mode and status reporting. This component is only used by GalaxyClient, not by ConstellationClient or DeviceManager.</p>
<p><strong>Key Features</strong>:</p>
<p><strong>Banner and Branding</strong>: Shows ASCII art banner when GalaxyClient starts, creating a visual identity for the framework.</p>
<p><strong>Progress Indication</strong>: Uses Rich Progress bars for long-running operations like initialization:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">display</span><span class="o">.</span><span class="n">show_initialization_progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;[cyan]Initializing...&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># ... initialization work ...</span>
    <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;[green]Complete!&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Result Display</strong>: Formats execution results in readable tables:</p>
<div class="highlight"><pre><span></span><code><span class="n">display</span><span class="o">.</span><span class="n">display_result</span><span class="p">({</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;execution_time&quot;</span><span class="p">:</span> <span class="mf">23.45</span><span class="p">,</span>
    <span class="s2">&quot;rounds&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;constellation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;task_count&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
<p>This creates a formatted table showing status, time, rounds, and task count in color-coded output.</p>
<p><strong>Interactive Input</strong>: Provides user input prompts with styling:</p>
<div class="highlight"><pre><span></span><code><span class="n">user_input</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">get_user_input</span><span class="p">(</span><span class="s2">&quot;UFO[0]&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Colored Messages</strong>: Semantic color coding for different message types:
- Green (success): Task completed, connection established
- Red (error): Task failed, connection error
- Yellow (warning): Device disconnected, timeout
- Cyan (info): Status updates, progress</p>
<p><strong>Why Separate Component?</strong>: Keeping display logic separate from business logic makes it easy to replace or disable. For example, a web-based frontend could replace ClientDisplay without touching any other components.</p>
<hr />
<h2 id="support-components">Support Components</h2>
<p>These components support higher-level client operations by providing status aggregation and configuration management capabilities.</p>
<h3 id="statusmanager-system-wide-status-aggregation">StatusManager: System-Wide Status Aggregation</h3>
<p><strong>Purpose</strong>: Provides consolidated views of system health and performance across all devices. While DeviceRegistry stores individual device status, StatusManager aggregates this into system-wide metrics.</p>
<p><strong>Health Summary Example</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">summary</span> <span class="o">=</span> <span class="n">status_manager</span><span class="o">.</span><span class="n">get_device_health_summary</span><span class="p">()</span>
<span class="c1"># Returns:</span>
<span class="p">{</span>
    <span class="s2">&quot;total_devices&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;connected_devices&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;disconnected_devices&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;connection_rate&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># 60% connected</span>
    <span class="s2">&quot;devices_by_status&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;CONNECTED&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;IDLE&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;DISCONNECTED&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="s2">&quot;devices_with_issues&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="s2">&quot;device_3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="s2">&quot;multiple_connection_attempts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attempts&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Task Statistics</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="n">stats</span> <span class="o">=</span> <span class="n">status_manager</span><span class="o">.</span><span class="n">get_task_statistics</span><span class="p">()</span>
<span class="c1"># Returns:</span>
<span class="p">{</span>
    <span class="s2">&quot;total_tasks_executed&quot;</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span>
    <span class="s2">&quot;successful_tasks&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;failed_tasks&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="mf">0.945</span><span class="p">,</span>
    <span class="s2">&quot;average_execution_time&quot;</span><span class="p">:</span> <span class="mf">15.3</span><span class="p">,</span>  <span class="c1"># seconds</span>
    <span class="s2">&quot;tasks_by_device&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;windows_pc&quot;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="s2">&quot;linux_server&quot;</span><span class="p">:</span> <span class="mi">62</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Why This Matters</strong>: In production, you need to monitor system health. StatusManager provides the data needed for dashboards, alerts, and capacity planning. For example, if connection_rate drops below 80%, you might trigger an alert.</p>
<hr />
<h2 id="how-components-work-together-a-complete-example">How Components Work Together: A Complete Example</h2>
<p>Let's trace what happens when you call <code>device_manager.connect_device("windows_pc")</code>:</p>
<p><strong>Step 1: DeviceManager Initiates Connection</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># DeviceManager.connect_device()</span>
<span class="n">device_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>  <span class="c1"># Get device details</span>
<span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">update_device_status</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">DeviceStatus</span><span class="o">.</span><span class="n">CONNECTING</span><span class="p">)</span>  <span class="c1"># Update status</span>
</code></pre></div>
<p><strong>Step 2: WebSocketConnectionManager Establishes Connection</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># WebSocketConnectionManager.connect_to_device()</span>
<span class="n">transport</span> <span class="o">=</span> <span class="n">WebSocketTransport</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">await</span> <span class="n">transport</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">device_info</span><span class="o">.</span><span class="n">server_url</span><span class="p">)</span>  <span class="c1"># Create AIP transport</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_transports</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">transport</span>  <span class="c1"># Store transport</span>

<span class="c1"># Initialize AIP protocols for this connection</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_registration_protocols</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">RegistrationProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_task_protocols</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">TaskExecutionProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_device_info_protocols</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeviceInfoProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>

<span class="c1"># ⚠️ CRITICAL: Start message handler BEFORE sending registration</span>
<span class="c1"># This ensures we don&#39;t miss the server&#39;s registration response</span>
<span class="bp">self</span><span class="o">.</span><span class="n">message_processor</span><span class="o">.</span><span class="n">start_message_handler</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">transport</span><span class="p">)</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># Small delay to ensure handler is listening</span>

<span class="c1"># Register as constellation client using AIP RegistrationProtocol</span>
<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_constellation_client</span><span class="p">(</span><span class="n">device_info</span><span class="p">)</span>
</code></pre></div>
<p><strong>Step 3: MessageProcessor Starts Background Loop</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># MessageProcessor.start_message_handler()</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_device_messages</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">transport</span><span class="p">))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_message_handlers</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>  <span class="c1"># Store task for later cancellation</span>
</code></pre></div>
<p>Now MessageProcessor is running in the background, ready to receive messages via the AIP transport.</p>
<p><strong>Step 4: Device Registration Completes</strong></p>
<p>The device sends back HEARTBEAT with OK status (which serves as registration confirmation). Then WebSocketConnectionManager requests device info via <code>DeviceInfoProtocol</code>.</p>
<p><strong>Step 5: DeviceRegistry Updated with System Info</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># DeviceManager.connect_device() continues</span>
<span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">update_device_system_info</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">device_system_info</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">update_device_status</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">DeviceStatus</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="o">.</span><span class="n">set_device_idle</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>  <span class="c1"># Ready for tasks</span>
</code></pre></div>
<p><strong>Step 6: HeartbeatManager Starts Monitoring</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># HeartbeatManager.start_heartbeat()</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_send_heartbeat_loop</span><span class="p">(</span><span class="n">device_id</span><span class="p">))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_tasks</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>
</code></pre></div>
<p>Now HeartbeatManager is running in the background, sending heartbeats every 30 seconds.</p>
<p><strong>Step 7: Connection Complete</strong></p>
<p>All components are now working together:
- DeviceRegistry knows the device is IDLE and ready
- WebSocketConnectionManager has an active AIP Transport with initialized protocols
- MessageProcessor is listening for incoming messages via the transport
- HeartbeatManager is monitoring connection health
- TaskQueueManager is ready to queue tasks if device becomes busy</p>
<p>This coordinated setup ensures reliable device communication.</p>
<hr />
<h2 id="component-dependencies">Component Dependencies</h2>
<p>Understanding component dependencies helps when debugging or extending the system:</p>
<div class="highlight"><pre><span></span><code>DeviceManager (creates all components)
├── DeviceRegistry (no dependencies - foundational)
├── WebSocketConnectionManager (depends on: DeviceRegistry for task name)
├── HeartbeatManager (depends on: WebSocketConnectionManager, DeviceRegistry)
├── MessageProcessor (depends on: DeviceRegistry, HeartbeatManager, WebSocketConnectionManager)
└── TaskQueueManager (no dependencies - independent)
</code></pre></div>
<p><strong>Construction Order</strong>: DeviceManager must create components in dependency order:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">heartbeat_interval</span><span class="p">,</span> <span class="n">reconnect_delay</span><span class="p">):</span>
    <span class="c1"># 1. DeviceRegistry first (no dependencies)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span> <span class="o">=</span> <span class="n">DeviceRegistry</span><span class="p">()</span>

    <span class="c1"># 2. WebSocketConnectionManager (needs task_name only)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection_manager</span> <span class="o">=</span> <span class="n">WebSocketConnectionManager</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>

    <span class="c1"># 3. HeartbeatManager (depends on connection_manager and device_registry)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_manager</span> <span class="o">=</span> <span class="n">HeartbeatManager</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_manager</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="p">,</span>
        <span class="n">heartbeat_interval</span>
    <span class="p">)</span>

    <span class="c1"># 4. MessageProcessor (depends on all previous components)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message_processor</span> <span class="o">=</span> <span class="n">MessageProcessor</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_registry</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heartbeat_manager</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_manager</span>
    <span class="p">)</span>

    <span class="c1"># 5. TaskQueueManager (independent)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">task_queue_manager</span> <span class="o">=</span> <span class="n">TaskQueueManager</span><span class="p">()</span>
</code></pre></div>
<p><strong>Why This Order Matters</strong>: If we created MessageProcessor before HeartbeatManager, we'd get an error because MessageProcessor's constructor expects HeartbeatManager to exist. The dependency graph dictates construction order.</p>
<hr />
<h2 id="testing-components">Testing Components</h2>
<p>The modular design makes components easy to test in isolation:</p>
<p><strong>Testing DeviceRegistry</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># No external dependencies needed</span>
<span class="n">registry</span> <span class="o">=</span> <span class="n">DeviceRegistry</span><span class="p">()</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register_device</span><span class="p">(</span><span class="s2">&quot;test_device&quot;</span><span class="p">,</span> <span class="s2">&quot;ws://localhost:5000&quot;</span><span class="p">,</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">registry</span><span class="o">.</span><span class="n">is_device_registered</span><span class="p">(</span><span class="s2">&quot;test_device&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Testing WebSocketConnectionManager</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Mock the WebSocket connection</span>
<span class="n">mock_websocket</span> <span class="o">=</span> <span class="n">AsyncMock</span><span class="p">()</span>
<span class="n">connection_manager</span> <span class="o">=</span> <span class="n">WebSocketConnectionManager</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">connection_manager</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="s2">&quot;test_device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mock_websocket</span>

<span class="c1"># Test message sending</span>
<span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">send_task_to_device</span><span class="p">(</span><span class="s2">&quot;test_device&quot;</span><span class="p">,</span> <span class="n">task_request</span><span class="p">)</span>
<span class="n">mock_websocket</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
</code></pre></div>
<p><strong>Testing HeartbeatManager</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Inject mock dependencies</span>
<span class="n">mock_connection_manager</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
<span class="n">mock_registry</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
<span class="n">heartbeat_manager</span> <span class="o">=</span> <span class="n">HeartbeatManager</span><span class="p">(</span><span class="n">mock_connection_manager</span><span class="p">,</span> <span class="n">mock_registry</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span>

<span class="c1"># Test heartbeat loop</span>
<span class="n">heartbeat_manager</span><span class="o">.</span><span class="n">start_heartbeat</span><span class="p">(</span><span class="s2">&quot;test_device&quot;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Let loop run</span>
<span class="k">assert</span> <span class="n">mock_connection_manager</span><span class="o">.</span><span class="n">get_connection</span><span class="o">.</span><span class="n">called</span>
</code></pre></div>
<p><strong>Why Testability Matters</strong>: Complex systems are hard to test. By breaking DeviceManager into 5 focused components, we can write targeted unit tests for each component's specific behavior, making bugs easier to find and fix.</p>
<hr />
<h2 id="summary">Summary</h2>
<p>Galaxy Client's component architecture demonstrates several important design principles:</p>
<p><strong>Single Responsibility</strong>: Each component does one thing well. DeviceRegistry stores state, WebSocketConnectionManager handles networking, HeartbeatManager monitors health, MessageProcessor routes messages, TaskQueueManager manages queues.</p>
<p><strong>Dependency Injection</strong>: DeviceManager creates components and injects dependencies, making the system flexible and testable. Want to replace WebSocketConnectionManager with a different implementation? Just swap it out while keeping the interface.</p>
<p><strong>Separation of Concerns</strong>: Business logic (in DeviceManager) is separate from display logic (in ClientDisplay) and orchestration support (in StatusManager). Each layer can evolve independently.</p>
<p><strong>Asynchronous Background Services</strong>: HeartbeatManager and MessageProcessor run as independent asyncio tasks, enabling concurrent operations without blocking the main execution flow.</p>
<p>This design makes Galaxy Client maintainable, extensible, and testable. When you understand how components collaborate, you can confidently modify or extend the system.</p>
<h2 id="related-documentation_1">Related Documentation</h2>
<ul>
<li><a href="../device_manager/">DeviceManager Reference</a> - See how DeviceManager orchestrates these components</li>
<li><a href="../constellation_client/">ConstellationClient</a> - Learn how components are used in the coordination layer</li>
<li><a href="../overview/">Overview</a> - Understand the broader Galaxy Client architecture</li>
<li><a href="../aip_integration/">AIP Integration</a> - Learn about the message protocol components use</li>
<li><a href="../../agent_registration/device_registry/">DeviceRegistry Details</a> - Deep dive into device state management</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../device_manager/" class="btn btn-neutral float-left" title="DeviceManager"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../aip_integration/" class="btn btn-neutral float-right" title="AIP Integration">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../device_manager/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../aip_integration/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      <script src="../../../javascripts/mermaid-init.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
